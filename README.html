<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>dstar-gantry - convenience wrapper for container-based dstar corpus operations</title>
<link rel="stylesheet" href="perlpod.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#INSTALLATION">INSTALLATION</a>
    <ul>
      <li><a href="#Requirements">Requirements</a></li>
      <li><a href="#Installation-Procedure">Installation Procedure</a></li>
    </ul>
  </li>
  <li><a href="#USAGE">USAGE</a>
    <ul>
      <li><a href="#Gantry-Options">Gantry Options</a></li>
      <li><a href="#Gantry-Actions">Gantry Actions</a>
        <ul>
          <li><a href="#init">init</a></li>
          <li><a href="#sync-host">sync-host</a></li>
          <li><a href="#sync-self">sync-self</a></li>
          <li><a href="#sync">sync</a></li>
          <li><a href="#pull">pull</a></li>
          <li><a href="#gc">gc</a></li>
          <li><a href="#BUILD_ACTION">BUILD_ACTION...</a></li>
        </ul>
      </li>
      <li><a href="#Docker-Options">Docker Options</a></li>
      <li><a href="#Container-Actions">Container Actions</a></li>
      <li><a href="#Container-Environment-Variables">Container Environment Variables</a></li>
    </ul>
  </li>
  <li><a href="#EXAMPLES">EXAMPLES</a>
    <ul>
      <li><a href="#Common-Prerequisites">Common Prerequisites</a></li>
      <li><a href="#Example:-Corpus-Build">Example: Corpus Build</a></li>
      <li><a href="#Example:-Corpus-Update">Example: Corpus Update</a></li>
      <li><a href="#Example:-Corpus-Metadata-Update">Example: Corpus Metadata Update</a></li>
      <li><a href="#Example:-Corpus-Build-Archive">Example: Corpus Build Archive</a></li>
      <li><a href="#Example:-Corpus-Deployment-Archive">Example: Corpus Deployment Archive</a></li>
      <li><a href="#Example:-Corpus-Removal">Example: Corpus Removal</a></li>
    </ul>
  </li>
  <li><a href="#CAVEATS">CAVEATS</a>
    <ul>
      <li><a href="#docker-storage-drivers">docker storage drivers</a></li>
      <li><a href="#build-responsibly">build responsibly</a></li>
      <li><a href="#log-changes">log changes</a></li>
    </ul>
  </li>
  <li><a href="#KNOWN-BUGS-AND-COMMON-ERRORS">KNOWN BUGS AND COMMON ERRORS</a></li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>dstar-gantry - convenience wrapper for container-based dstar corpus operations</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code> dstar-gantry.sh [GANTRY_OPTS] [GANTRY_ACTION(s)] [-- [DOCKER_OPTS] [-- [BUILD_ARGS]]]

 dstar-gantry.sh Options (GANTRY_OPTS):
   -h  , -help           # this help message
   -V  , -version        # show program version and exit
   -n  , -dry-run        # just print what we would do
   -fg , -bg             # run container in foreground (default) or background
   -rm , -persist        # remove container on termination (default) or don&#39;t
   -c CORPUS             # dstar corpus label (required for most operations)
   -d DSTAR_ROOT         # host path for sparse persistent dstar superstructure (default=$HOME/dstar)
   -C CORPUS_ROOT        # host path for dstar corpus checkout (default=DSTAR_ROOT/corpora/CORPUS)
   -S CORPUS_SRC         # host path of dstar corpus sources (default=DSTAR_ROOT/sources/CORPUS/ if present)
   -R RESOURCES_DIR      # host path for persistent CAB resources (default=DSTAR_ROOT/resources/ if present)
   -RO                   # mount RESOURCES_DIR read-only (suppress resource synchronization by container)
   -f RCFILE             # read gantry variables from RCFILE (bash source; default=$HOME/.dstar-gantry.rc)
   -i IMAGE              # use docker image IMAGE (default=lex.dwds.de:443/dstar/dstar-buildhost:latest)
   -e VAR=VALUE          # environment variables are passed to docker-run(1) -e
   -E ENV_FILE           # environment files are passed to docker-run(1) --env-file
   -v /PATH:/MOUNT       # volume options are are passed to docker-run(1) -v
   -x CABX_RUN           # cabx servers for container &#39;run&#39; action (default=dstar-http-9096)
   -p HTTP_PORT          # map container port 80 to host HTTP_PORT for &#39;run&#39; action
   -u USER               # build user or UID (default=ddc-admin)
   -g GROUP              # build group or GID (default=ddc-admin)

 dstar-gantry.sh Actions (GANTRY_ACTION(s)):
   init                  # (re-)initialize persistent sparse local DSTAR_ROOT checkout
   sync-host             # syncronize local DSTAR_ROOT checkout via `svn update`
   sync-self             # syncronize local DSTAR_ROOT checkout via `svn update`
   sync                  # alias for &#39;sync-host&#39; and &#39;sync-self&#39;
   pull                  # retrieve selected IMAGE from docker registry (may require `docker login`)
   gc                    # clean up stale local dstar-buildhost docker images
   ...                   # other actions are passed to container docker/build script (see below)

 Docker Options (DOCKER_OPTS): see docker-run(1).

 Container docker/build Arguments (BUILD_ARGS; see also `dstar-gantry.sh help`):
   help                  # show help for container docker/build script
   self-test             # run rudimentary self-test(s)
   checkout              # checkout corpus build superstructure to CORPUS_ROOT/build/
   build                 # index a corpus in CORPUS_ROOT/build from sources in CORPUS_SRC/
   update                # update an existing index in CORPUS_ROOT/build/ from CORPUS_SRC/
   update-meta           # update index metadata in in CORPUS_ROOT/build/ from CORPUS_SRC/
   test                  # test a corpus build in CORPUS_ROOT/build/
   archive-build         # archive CORPUS_ROOT/build/ to ${dstar_archive_dir}
   archive-publish       # archive publishable corpus data to ${dstar_archive_dir}
   install               # install CORPUS_ROOT/build/ to CORPUS_ROOT/{server,web}/
   uninstall             # recursively delete CORPUS_ROOT/{server,web}/
   publish               # deploy CORPUS_ROOT/build/ to production host(s)
   run                   # run CORPUS_ROOT/{server,web}/ corpus instance in container
   shell                 # run a bash shell in the container
   exec CMD...           # execute an arbitrary CMD... in container

 Useful container mounts under /dstar:
  config/                # global dstar configuration (read-only)
  resources/             # CAB analysis resources (read-only)
  sources/CORPUS/        # corpus TEI-XML sources (read-only)
  corpora/CORPUS/        # corpus instance checkout (read-write, required)
  corpora/CORPUS/config.local
                         # local corpus configuration overrides

 Host Environment Variables:
   SSH_AUTH_SOCK         # (required) ssh-agent(1) socket

 Container Environment Variables:
  SSH_AUTH_SOCK               # ssh-agent socket (should probably be a bind-mount)
  dstar_init_hooks            # default INIT_HOOK_DIRS (=)

  dstar_build_uid             # user-id in host system (=`id -u`)
  dstar_build_gid             # group-id in host system (=`id -g`)
  dstar_build_umask           # umask for build process (=002)

  dstar_corpora               # corpora to operate on (whitespace-separated list)
  dstar_corpus                # alias for dstar_corpora (=)
  dstar_archive_dir           # target directory for archive-* targets (=)

  dstar_sync_resources        # sync resources (auto|no|force; default=auto)
  dstar_sync_rcfiles          # resources to be synchronized (default:empty -&gt; all)
  dstar_checkout_corpus_opts  # options for dstar-checkout-corpus.sh (=-force -local-config)
  dstar_build_sh_opts         # options for CORPUS/build/build.sh (=-echo-preset=make-info)
  dstar_cabx_run              # cabx expanders to run (=dstar-http-9096)
  dstar_relay_conf            # socat relay configuration (=/etc/default/dstar-relay)

  ...                         # all environment variables are passed down to child processes (e.g. make)</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>The <code>dstar-gantry</code> project provides a thin top-level wrapper script (<code>dstar-gantry.sh</code>) for D* corpus operations using the latest <code>dstar-buildhost</code> docker image pulled from the ZDL docker registry at <code>https://lex.dwds.de:443</code>. The <code>dstar-buildhost</code> docker container invoked by <code>dstar-gantry.sh</code> can simulate any of the <a href="https://kaskade.dwds.de/dstar/doc/README.html#BUILDHOST"><code>BUILDHOST</code></a>, <a href="https://kaskade.dwds.de/dstar/doc/README.html#RUNHOST"><code>RUNHOST</code></a>, and/or <a href="https://kaskade.dwds.de/dstar/doc/README.html#WEBHOST"><code>WEBHOST</code></a> D* <a href="https://kaskade.dwds.de/dstar/doc/README.html#Hosts-and-Roles">host roles</a>, but is mostly intended to act as a (virtual) <a href="https://kaskade.dwds.de/dstar/doc/README.html#BUILDHOST"><code>BUILDHOST</code></a>.</p>

<p>The remainder of this document describes the <code>dstar-gantry.sh</code> wrapper script in more detail; it does <b>not</b> constitute exhaustive documentation for the dstar corpus management framework or its features and functionality, not even of that subset of the dstar functionality which can be invoked through <code>dstar-gantry.sh</code>. Please consult the relevant <a href="https://kaskade.dwds.de/dstar/doc/">dstar documentation</a> if you have questions which aren&#39;t addressed by this document.</p>

<p>See <a href="#INSTALLATION">&quot;INSTALLATION&quot;</a> for instructions on installing <code>dstar-gantry</code> on your local machine, see <a href="#USAGE">&quot;USAGE&quot;</a> for details on the various options and arguments, and see <a href="#EXAMPLES">&quot;EXAMPLES&quot;</a> for some example <code>dstar-gantry.sh</code> invocations.</p>

<h1 id="INSTALLATION">INSTALLATION</h1>

<p>This section describes the installation procedure for debian-based linux machines. <code>dstar-gantry</code> was developed and tested on an x86_64 machine running Debian GNU/Linux 10 (&quot;buster&quot;). Other systems and architectures may work too, but are not explicitly supported.</p>

<p>If you are running <code>dstar-gantry.sh</code> on a &quot;semi-production&quot; host (e.g. lal.dwds.de), you can skip to <a href="#initialize-persistent-data">&quot;initialize persistent data&quot;</a>.</p>

<h2 id="Requirements">Requirements</h2>

<dl>

<dt id="debian-packages">debian packages</dt>
<dd>

<p><code>dstar-gantry.sh</code> requires the debian packages: <code>bash</code>, <code>openssh-client</code>, and <code>subversion</code> to be installed on the host system:</p>

<pre><code> $ sudo apt-get update &amp;&amp; sudo apt-get install bash openssh-client subversion</code></pre>

</dd>
<dt id="docker">docker</dt>
<dd>

<p>You will need <a href="https://docs.docker.com/get-docker/">docker</a> installed on your local machine with an appropriate <a href="#docker-storage-drivers">docker storage driver</a>, and the requisite <a href="https://docs.docker.com/engine/install/linux-postinstall/">permissions</a> for your local user account (e.g. membership in the <code>docker</code> group). <code>dstar-gantry</code> was developed and tested using the <code>docker-ce</code> and <code>docker-ce-client</code> packages version 19.03.8. See <a href="https://docs.docker.com/get-docker/">&quot;https://docs.docker.com/get-docker/&quot;</a> for instructions on how to install docker.</p>

</dd>
<dt id="registry-credentials">registry credentials</dt>
<dd>

<p>If you wish to make use of gantry&#39;s <code>pull</code> action to acquire the latest <code>dstar-buildhost</code> docker image (recommended), you will need credentials (username and password) for the ZDL docker registry, and will need to manually log into the registry using <a href="https://docs.docker.com/engine/reference/commandline/login/"><code>docker login</code></a>:</p>

<pre><code> $ docker login https://lex.dwds.de:443
 Username: ZDL_DOCKER_REGISTRY_USERNAME
 Password: ZDL_DOCKER_REGISTRY_PASSWORD
 Login Succeeded</code></pre>

<p>Contact the <code>dstar-gantry</code> maintainer or the ZDL docker registry maintainer (currently Gregor Middell) if you do not have credentials for the ZDL docker registry.</p>

</dd>
<dt id="ssh-agent">ssh-agent</dt>
<dd>

<p>You will need an accessible <a href="https://en.wikipedia.org/wiki/Ssh-agent">ssh-agent</a> for your local user account as indicated by the <code>SSH_AUTH_SOCK</code> environment variable, with at least one registered identity (public+private key-pair).</p>

<p>In order to avoid password prompts during sparse subversion checkouts on the local host (recommended), your ssh identity should be authorized for password-free access to <code>svn.dwds.de</code>, as whatever user your <a href="https://linux.die.net/man/5/ssh_config"><code>~/.ssh/config</code></a> specifies (by default the same username as on your local machine).</p>

<p>In order to avoid password prompts during implicit subversion operations in the <code>dstar-buildhost</code> container invoked by gantry (recommended), your ssh identity should be authorized for password-free access to <code>ddc@svn.dwds.de</code>.</p>

<p>If you wish to make use of gantry&#39;s automatic resource synchronization features (default, recommended), your identity should be authorized for password-free access to <code>${CABRC_RSYNC_USER}@${CABRC_SYNCHOST}</code> (typically <code>ddc@data.dwds.de</code>).</p>

<p>In order to publish corpus indices via gantry to remote RUNHOSTs and/or WEBHOSTs, your identity will need to be authorized for password-free access to <code>${PUBLISH_DEST}</code> and/or <code>${WEB_PUBLISH_DEST}</code> (typically <code>ddc-admin@{data,kaskade}.dwds.de</code>).</p>

<p>See <a href="https://kaskade.dwds.de/dstar/doc/README_ssh.html"><code>dstar/doc/README_ssh.txt</code></a> for more details.</p>

</dd>
</dl>

<h2 id="Installation-Procedure">Installation Procedure</h2>

<dl>

<dt id="download-gantry">download gantry</dt>
<dd>

<p>Checkout the gantry project itself from SVN to your local machine, for example to $HOME/dstar-gantry:</p>

<pre><code> $ svn checkout svn+ssh://svn.dwds.de/home/svn/dev/ddc-dstar/docker/gantry/trunk ~/dstar-gantry</code></pre>

<p>Example output (trimmed):</p>

<pre><code> A    ~/dstar-gantry/bin
 A    ~/dstar-gantry/bin/dstar-gantry.sh
 ...
 Checked out revision 32806.</code></pre>

</dd>
<dt id="setup-PATH">setup PATH</dt>
<dd>

<p>Put the <code>dstar-gantry.sh</code> script in your <code>PATH</code> (optional, recommended):</p>

<pre><code> $ export PATH=$PATH:$HOME/dstar-gantry/bin</code></pre>

<p>... or just symlink it into some directory already in your <code>PATH</code>:</p>

<pre><code> $ sudo ln -s $HOME/dstar-gantry/bin/*.sh /usr/local/bin</code></pre>

</dd>
<dt id="initialize-persistent-data">initialize persistent data</dt>
<dd>

<p>Initialize persistent sparse local dstar checkout (usually in <code>$HOME/dstar</code>) with the <a href="#init"><code>init</code></a> action:</p>

<pre><code> $ dstar-gantry.sh init</code></pre>

<p>Example output (trimmed):</p>

<pre><code> dstar-gantry.sh: INFO: init: (re-)initializing sparse persistent DSTAR_ROOT=/home/USER/dstar
 dstar-gantry.sh: CMD: svn co --depth=files svn+ssh://svn.dwds.de/home/svn/dev/ddc-dstar/trunk /home/USER/dstar
 A    /home/USER/dstar/.DSTAR_ROOT
 ...
 dstar-gantry.sh: INFO: no container actions BUILD_ARG(s) specified: nothing to do.</code></pre>

<p><b>NOTE</b>: if you are running <code>dstar-gantry.sh</code> on a &quot;semi-production&quot; host (e.g. lal.dwds.de), you should probably be using the central dstar checkout in <code>/home/ddc-dstar/dstar/</code> rather than a &quot;private&quot; gantry checkout in <code>$HOME/dstar/</code> ... in this case, the gantry maintainer has probably already installed an appropriate machine-wide <a href="#f-RCFILE"><code>/etc/dstar-gantry.rc</code></a>, and you may want to create a convenience symlink in you home directory to remind you:</p>

<pre><code> $ ln -sfT /home/ddc-dstar/dstar ~/dstar</code></pre>

</dd>
<dt id="retrieve-docker-image">retrieve docker image</dt>
<dd>

<p>Download the latest <code>dstar-buildhost</code> image from the ZDL docker registry with the <a href="#pull"><code>pull</code></a> action:</p>

<pre><code> $ dstar-gantry.sh pull</code></pre>

<p>Example output (trimmed):</p>

<pre><code> dstar-gantry.sh: CMD: docker pull lex.dwds.de:443/dstar/dstar-buildhost:latest
 latest: Pulling from dstar/dstar-buildhost
 
 Digest: sha256:e5b47f225619e6b433df0dbcdcdfdfdb93e703893ceb6ed9f78f338e77358a77
 Status: Downloaded newer image for lex.dwds.de:443/dstar/dstar-buildhost:latest
 lex.dwds.de:443/dstar/dstar-buildhost:latest
 dstar-gantry.sh: INFO: no container actions BUILD_ARG(s) specified: nothing to do.</code></pre>

</dd>
<dt id="run-self-test">run self-test</dt>
<dd>

<p>Run rudimentary self-tests with the gantry <a href="#self-test"><code>self-test</code></a> action:</p>

<pre><code> $ dstar-gantry.sh self-test</code></pre>

<p>Example output (trimmed):</p>

<pre><code> dstar-gantry.sh: INFO: using DSTAR_ROOT=/home/USER/dstar
 dstar-gantry.sh: WARNING: neither CORPUS nor CORPUS_ROOT specified (use the -c or -C options)
 dstar-gantry.sh: WARNING: no CORPUS_SRC directory specified (expect trouble if you&#39;re trying to (re-)index a corpus)
 dstar-gantry.sh: INFO: setting RESOURCE_DIR=/local/home/ddc-dstar/dstar/resources
 dstar-gantry.sh: WARNING: CORPUS_ROOT= does not exist (continuing anyway, YMMV)
 dstar-gantry.sh: CMD: docker run --rm -ti --name=dstar-gantry- ... self-test
 ...
 build INFO: running self-test(s)
 build INFO: TEST: checking for ssh-agent socket (dstar-nice.sh test -w &#39;/tmp/ssh-agent-wrap.sock&#39;)
 build INFO: TEST: checking for ssh-agent identity (test -n &quot;`dstar-nice.sh ssh-add -l | fgrep -v \&quot;no identities\&quot;`&quot;)
 build INFO: TEST: svn+ssh access (dstar-nice.sh svn st -u .DSTAR_ROOT)
 Status against revision:  32806
 build INFO: TEST: sync resources (dstar-nice.sh make -C resources sync-test)
 make: Entering directory &#39;/home/ddc-dstar/dstar/resources&#39;
 make: Leaving directory &#39;/home/ddc-dstar/dstar/resources&#39;
 build INFO: TEST: publish to default runhost (ssh &quot;ddc-admin@data.dwds.de&quot; /bin/true)
 build INFO: TEST: publish to default webhost (ssh &quot;ddc-admin@kaskade.dwds.de&quot; /bin/true)
 build INFO: self-test: all tests passed (6/6)</code></pre>

</dd>
</dl>

<h1 id="USAGE">USAGE</h1>

<pre><code> dstar-gantry.sh [GANTRY_OPTS] [GANTRY_ACTION(s)] [-- [DOCKER_OPTS] [-- [BUILD_ARGS]]]</code></pre>

<p>The <code>dstar-gantry.sh</code> wrapper script is a command-line tool in the UNIX tradition, and as such accepts a number of options and arguments:</p>

<dl>

<dt id="GANTRY_OPTS"><a href="#Gantry-Options">GANTRY_OPTS</a></dt>
<dd>

<p><code>GANTRY_OPTS</code> options are interpreted by the <code>dstar-gantry.sh</code> script itself, including some convenience wrappers for some common <a href="#Docker-Options">&quot;Docker Options&quot;</a>.</p>

</dd>
<dt id="GANTRY_ACTION-s"><a href="#Gantry-Actions">GANTRY_ACTION(s)</a></dt>
<dd>

<p><code>GANTRY_ACTION(s)</code> indicate which operation(s) are to be performed, typically corresponding directly to the <a href="#Container-Actions">&quot;Container Actions&quot;</a> of the same name.</p>

</dd>
<dt id="DOCKER_OPTS"><a href="#Docker-Options">DOCKER_OPTS</a></dt>
<dd>

<p><code>DOCKER_OPTS</code> are passed to the <a href="https://docs.docker.com/engine/reference/run/"><code>docker-run</code></a> subprocess for the embedded <code>dstar-buildhost</code> container.</p>

</dd>
<dt id="BUILD_ARGS"><a href="#Container-Actions">BUILD_ARGS</a></dt>
<dd>

<p><code>BUILD_ARGS</code> are passed to the <code>/dstar/docker/build</code> script invocation in the embedded <code>dstar-buildhost</code> container.</p>

</dd>
</dl>

<h2 id="Gantry-Options">Gantry Options</h2>

<dl>

<dt id="h--help">-h, -help</dt>
<dd>

<p>Display a brief help message.</p>

</dd>
<dt id="V--version">-V, -version</dt>
<dd>

<p>Display the version information for <code>dstar-gantry</code> itself.</p>

</dd>
<dt id="n--dry-run">-n, -dry-run</dt>
<dd>

<p>If specified, just prints what would have been done, but doesn&#39;t perform any destructive actions.</p>

</dd>
<dt id="fg--bg">-fg, -bg</dt>
<dd>

<p>Specifies whether to run the embedded <code>dstar-buildhost</code> container interactively in the foreground (<code>-fg</code>, default) or detached in the background (<code>-bg</code>). Foreground (<code>-fg</code>) operation is equivalent to the <code>docker-run</code> <code>--tty=true</code> and <code>--interactive=true</code> options and background (<code>-bg</code>) operation is equivalent to the <code>docker-run</code> <code>--detached=true</code> option. See <a href="https://docs.docker.com/engine/reference/run/#options">docker-run(1)</a> for details.</p>

<p>If you choose to run the container in the background (e.g. for <a href="#build">&quot;build&quot;</a> operations on large corpora), you can still view the default console ouptut with the <a href="https://docs.docker.com/engine/reference/commandline/logs/"><code>docker logs</code></a> command, or inspect the build logs in <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/log/</code> directly.</p>

</dd>
<dt id="rm--persist">-rm, -persist</dt>
<dd>

<p>Specifies whether (<code>-rm</code>) or not (<code>-persist</code>) to remove the embedded <code>dstar-buildhost</code> container when the requested <a href="#BUILD_ARGS">build operation(s)</a> have completed. This behavior is implemented in terms of the <code>docker-run</code> <code>--rm</code> option; see <a href="https://docs.docker.com/engine/reference/run/#options">docker-run(1)</a> for details. If you request container persistence with the <code>-persist</code> option (or the lower-level <a href="#DOCKER_OPTS">docker option</a> <code>--rm=false</code>), you will have to remove it yourself with the <a href="https://docs.docker.com/engine/reference/commandline/rm/"><code>docker rm</code></a> command.</p>

</dd>
<dt id="c-CORPUS">-c CORPUS</dt>
<dd>

<p>Specifies the dstar corpus label (&quot;collection label&quot;) for the operand corpus. Required for most operations.</p>

</dd>
<dt id="d-DSTAR_ROOT">-d DSTAR_ROOT</dt>
<dd>

<p>Specifies the host path (or symlink) used for (sparse) persistent dstar superstructure (default=<code>$HOME/dstar</code>). By default, persistent CAB resources and index data will be created here. This directory should be a sparse checkout of the <a href="https://kaskade.dwds.de/dstar/doc/README.html#Project-Directory-Structure">dstar project</a> containing at least partial checkouts of the <a href="https://kaskade.dwds.de/dstar/doc/README.html#doc"><code>doc/</code></a>, <a href="https://kaskade.dwds.de/dstar/doc/README.html#corpora"><code>corpora/</code></a>, <a href="https://kaskade.dwds.de/dstar/doc/README.html#sources"><code>sources/</code></a>, and <a href="https://kaskade.dwds.de/dstar/doc/README.html#resources"><code>resources/</code></a> subdirectories.</p>

<p>On &quot;semi-production&quot; dstar hosts (e.g. <code>lal.dwds.de</code>), you should typically use a global <code>DSTAR_ROOT</code> checkout in <code>/home/ddc-dstar/dstar</code>.</p>

</dd>
<dt id="C-CORPUS_ROOT">-C CORPUS_ROOT</dt>
<dd>

<p>Specifies the host path (or symlink) used for dstar corpus checkout (default=<code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a>/corpora/<a href="#c-CORPUS">CORPUS</a></code>). Implies volume mount <a href="#v-PATH:-MOUNT"><code>-v CORPUS_ROOT:/dstar/corpora/CORPUS</code></a>.</p>

</dd>
<dt id="S-CORPUS_SRC">-S CORPUS_SRC</dt>
<dd>

<p>Specifies the host path (or symlink) where dstar corpus sources reside (default=<code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a>/sources/<a href="#c-CORPUS">CORPUS</a>/</code> if present, otherwise <code>`readlink -m <a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/src`</code> if present, otherwise required). Implies volume mount <a href="#v-PATH:-MOUNT"><code>-v CORPUS_SRC:/dstar/sources/CORPUS:ro</code></a>.</p>

</dd>
<dt id="R-RESOURCES_DIR">-R RESOURCES_DIR</dt>
<dd>

<p>Specifies the host path (or symlink) for persistent CAB resources (default=<code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a>/resources/</code> if present). Implies volume mount <a href="#v-PATH:-MOUNT"><code>-v RESOURCES_DIR:/dstar/resources</code></a>.</p>

</dd>
<dt id="RO">-RO</dt>
<dd>

<p>If the <code>-RO</code> option is specified and <code><a href="#R-RESOURCES_DIR">RESOURCES_DIR</a></code> is present on the local machine, then <code><a href="#R-RESOURCES_DIR">RESOURCES_DIR</a></code> will be mounted read-only in the container, which suppresses resource synchronization in the running container. If you want each container invocation to ensure that its CAB resources are fully up-to-date, you should <b>NOT</b> use this option. It can be useful to bypass synchronization overhead, minimize network bandwidth, and ensure resource consistency for post-hoc updates of existing corpora though. Use with consideration.</p>

</dd>
<dt id="f-RCFILE">-f RCFILE</dt>
<dd>

<p>Reads gantry configuration variables from <code>RCFILE</code> on the host machine. <code>RCFILE</code> is evaluated as bash source. May be specified more than once, in which case files are read in the order specified and later declarations may clobber earlier ones. By default, <code>dstar-gantry.sh</code> reads the following global configuration files (if they exist) before evaluating any <code>RCFILE</code> specified on the command-line:</p>

<pre><code> /etc/dstar-gantry.rc
 $HOME/.dstar-gantry.rc</code></pre>

<p>See the example <a href="http://svn.dwds.de/websvn/filedetails.php?repname=D%2A%3A+Dev-Repository&amp;path=%2Fddc-dstar%2Fdocker%2Fgantry%2Ftrunk%2Fdstar-gantry.rc"><code>dstar-gantry.rc</code> file</a> in the <code>dstar-gantry</code> distribution for a list of available variables.</p>

</dd>
<dt id="i-IMAGE">-i IMAGE</dt>
<dd>

<p>Specifies the docker image to be <a href="#pull">pulled</a> and/or invoked via <a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a>. Default is <code>lex.dwds.de:443/dstar/dstar-buildhost:latest</code>.</p>

</dd>
<dt id="e-VAR-VALUE">-e VAR=VALUE</dt>
<dd>

<p>Specify an environment variable override for the container via <a href="https://docs.docker.com/engine/reference/run/#env-environment-variables"><code>docker run -e VAR=VALUE</code></a>.</p>

</dd>
<dt id="E-ENV_FILE">-E ENV_FILE</dt>
<dd>

<p>Specify a file containing environment variable overrides for the container, via <a href="https://docs.docker.com/engine/reference/run/#env-environment-variables"><code>docker run --env-file ENV_FILE</code></a>.</p>

</dd>
<dt id="v-PATH:-MOUNT">-v /PATH:/MOUNT</dt>
<dd>

<p>Mounts the host directory <code>/PATH</code> as a volume into the container at <code>/MOUNT</code>, passed to <a href="https://docs.docker.com/engine/reference/run/#volume-shared-filesystems"><code>docker_run -v</code></a>.</p>

<p>Potentially useful volume mounts <code>/MOUNT</code> include:</p>

<pre><code>  /dstar/config/            # global dstar configuration (read-only)
  /dstar/resources/         # CAB analysis resources (read-only)</code></pre>

</dd>
<dt id="x-CABX_RUN">-x CABX_RUN</dt>
<dd>

<p>Select container-internal CAB server(s) to start for container <a href="#run">run</a> action; default=<code>dstar-http-9096</code>.</p>

</dd>
<dt id="p-HTTP_PORT">-p HTTP_PORT</dt>
<dd>

<p>Map containers port 80 to host port <code>HTTP_PORT</code> for <a href="#run"><code>run</code></a> action via <a href="https://docs.docker.com/engine/reference/run/#expose-incoming-ports"><code>docker run -p HTTP_PORT:80</code></a>.</p>

</dd>
<dt id="u-USER">-u USER</dt>
<dd>

<p>Specifies username or UID of host build user (default=<code>ddc-admin</code> if present, otherwise current user). If the UID does not exist in the container (it probably doesn&#39;t), it will be created.</p>

</dd>
<dt id="g-GROUP">-g GROUP</dt>
<dd>

<p>Specifies group name or GID of host build user (default=<code>ddc-admin</code> if present, otherwise current group). If the GID does not exist in the container (it probably doesn&#39;t), it will be created.</p>

</dd>
</dl>

<h2 id="Gantry-Actions">Gantry Actions</h2>

<h3 id="init">init</h3>

<p>(Re-)initializes persistent sparse local <a href="#d-DSTAR_ROOT"><code>DSTAR_ROOT</code></a> checkout on the local host (usually <code>$HOME/dstar</code>). You should only have to call this once per host, before performing any other <code>dstar-gantry.sh</code> actions.</p>

<h3 id="sync-host">sync-host</h3>

<p>Synchronizes the persistent sparse local <a href="#d-DSTAR_ROOT"><code>DSTAR_ROOT</code></a> checkout on the local host (usually <code>$HOME/dstar</code>) via <code>svn update</code>. You should typically call this before each <code>dstar-gantry.sh</code> session, in order to ensure that your <code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a></code> checkout is up-to-date.</p>

<h3 id="sync-self">sync-self</h3>

<p>Attempts to synchronize the local <code>dstar-gantry</code> checkout via <code>svn update</code>. If the <code>dstar-gantry.sh</code> script (or symlink) does not resolve to an SVN working copy on your system, this won&#39;t work, and you will need to perform any updates manually. You should typically call this before each <code>dstar-gantry.sh</code> operation, in order to ensure that your <code>dstar-gantry.sh</code> itself is up-to-date.</p>

<h3 id="sync">sync</h3>

<p>Convenience alias for the <a href="#sync-host">&quot;sync-host&quot;</a> and <a href="#sync-self">&quot;sync-self&quot;</a> actions.</p>

<h3 id="pull">pull</h3>

<p>Retrieves the selected <a href="#i-IMAGE"><code>dstar-buildhost</code> IMAGE</a> from the ZDL docker registry. May require a preceding <a href="#registry-credentials"><code>docker login</code></a>.</p>

<h3 id="gc">gc</h3>

<p>Cleans up stale <code>dstar-buildhost</code> docker images on the local host.</p>

<h3 id="BUILD_ACTION"><a href="#Container-Actions">BUILD_ACTION...</a></h3>

<p>Other non-option arguments (not beginning with a dash &quot;-&quot;) are passed verbatim as <a href="#Container-Actions">&quot;Container Actions&quot;</a> to the <code>/dstar/docker/build</code> script in the embedded <code>dstar-buildhost</code> container.</p>

<h2 id="Docker-Options">Docker Options</h2>

<p>Docker options following the first <code>--</code> on the <code>dstar-gantry.sh</code> command-line are passed verbatim to the <a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a> subprocess for the selected <a href="#i-IMAGE"><code>dstar-buildhost</code> IMAGE</a>. If you need to tweak the <code>docker run</code> call with more than the <a href="#e-VAR-VALUE"><code>-e VAR=VALUE</code></a>, <a href="#E-ENV_FILE"><code>-E ENV_FILE</code></a>, or <a href="#v-PATH:-MOUNT"><code>-v /PATH:/MOUNT</code></a> options, this is how to do it.</p>

<h2 id="Container-Actions">Container Actions</h2>

<p>All arguments following the second <code>--</code> on the <code>dstar-gantry.sh</code> command-line are passed verbatim to the <code>/dstar/docker/build</code> script call in the embedded <a href="#i-IMAGE"><code>dstar-buildhost</code></a> container. See the output of <code>dstar-gantry.sh help</code> for a synopsis of the <code>/dstar/docker/build</code> calling conventions.</p>

<dl>

<dt id="help">help</dt>
<dd>

<p>Shows a brief help message from the container <code>/dstar/docker/build</code> script.</p>

</dd>
<dt id="self-test">self-test</dt>
<dd>

<p>Runs some rudimentary self-test(s) and reports results. Not all self-tests need to pass in order for <code>dstar-gantry.sh</code> to be useful; the functionality you need depends on what you&#39;re trying to do and your personal preferences.</p>

</dd>
<dt id="checkout">checkout</dt>
<dd>

<p>Creates or updates corpus build superstructure in <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> from SVN. This is basically a wrapper for <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Checkout"><code>dstar-checkout-corpus.sh</code></a>, i.e. a <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Checkout">corpus checkout</a>. You should probably never have to invoke this action manually, since it is implicitly called by the higher-level corpus operations such as <a href="#build">&quot;build&quot;</a>, <a href="#update">&quot;update&quot;</a>, <a href="#publish">&quot;publish&quot;</a>, etc.</p>

</dd>
<dt id="build">build</dt>
<dd>

<p>(Re-)indexes a corpus in <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> from TEI-XML sources in <a href="#S-CORPUS_SRC"><code>CORPUS_SRC/</code></a>. This is basically a wrapper for <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Checkout"><code>dstar-checkout-corpus.sh</code></a> and <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh-and-cron-autobuild.sh"><code>CORPUS_ROOT/build/build.sh -build</code></a>, i.e. a <a href="https://kaskade.dwds.de/dstar/doc/talks/corpus-ops-2019/#howto-build">full corpus re-build</a>.</p>

</dd>
<dt id="update">update</dt>
<dd>

<p>Updates an existing corpus index in <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> from TEI-XML sources in <a href="#S-CORPUS_SRC"><code>CORPUS_SRC/</code></a>. This is basically a wrapper for <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Checkout"><code>dstar-checkout-corpus.sh</code></a> and <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh-and-cron-autobuild.sh"><code>CORPUS_ROOT/build/build.sh -update</code></a>, i.e. an <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Incremental-Update">incremental corpus update</a> as described <a href="https://kaskade.dwds.de/dstar/doc/talks/corpus-ops-2019/#howto-update">here</a>.</p>

</dd>
<dt id="update-meta">update-meta</dt>
<dd>

<p>Updates metadata for an existing corpus index in <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT/build</code></a> from TEI-XML sources in <a href="#S-CORPUS_SRC"><code>CORPUS_SRC/</code></a>. This is basically a wrapper for <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Checkout"><code>dstar-checkout-corpus.sh</code></a> and <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh-and-cron-autobuild.sh"><code>CORPUS_ROOT/build/build.sh -update-meta</code></a>, i.e. a <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Metadata-Update">corpus metadata update</a>.</p>

</dd>
<dt id="test">test</dt>
<dd>

<p>Runs automated consistency tests for an existing corpus build in <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/test/</code>. This is basically a wrapper for <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Checkout"><code>dstar-checkout-corpus.sh</code></a> and <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh-and-cron-autobuild.sh"><code>CORPUS_ROOT/build/build.sh -test</code></a>, i.e. <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Consistency-Testing">corpus consistency tests</a>.</p>

</dd>
<dt id="archive-build">archive-build</dt>
<dd>

<p>Archives an existing corpus build-directory <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> to the directory <a href="#dstar_archive_dir"><code>${dstar_archive_dir}</code></a> if set, otherwise to the (corpus-specific) directory specified by the <code>ARC_BUILD_DIR</code> dstar make variable; usually <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/archive/</code>. The build-archive will be created as a gzipped tar archive <code><a href="#c-CORPUS">CORPUS</a>.build-<i>DATETIME</i>.tar.gz</code> where <i>DATETIME</i> is a timestamp in <i>YYYY-MM-DD.HHMMSS</i> format, and will include all intermediate build files in <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code>.</p>

</dd>
<dt id="archive-publish">archive-publish</dt>
<dd>

<p>Archives publishable corpus data from the corpus build directory <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> to the directory <a href="#dstar_archive_dir"><code>${dstar_archive_dir}</code></a> if set, otherwise to the (corpus-specific) directory specified by the <code>ARC_PUBLISH_DIR</code> dstar make variable; usually <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/archive/</code>. The publish-archive will be created as a gzipped tar archive <code><a href="#c-CORPUS">CORPUS</a>.publish-<i>DATETIME</i>.tar.gz</code> where <i>DATETIME</i> is a timestamp in <i>YYYY-MM-DD.HHMMSS</i> format, and should contain all the index data required for a production runtime corpus instance on <a href="https://kaskade.dwds.de/dstar/doc/README.html#Hosts-and-Roles"><code>RUNHOST</code> and/or <code>WEBHOST</code></a>). Future versions of this software may support additional operations on such archives.</p>

<p>Note that archives created with the <code>archive-publish</code> action only include that subset of the data from local corpus build directory <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> which would be deployed by a <a href="#publish">&quot;publish&quot;</a> operation, and <b>not</b> the actual published index data from remote runtime &quot;production&quot; host(s) as specified by the <code>PUBLISH_DEST</code> and/or <code>WEB_PUBLISH_DEST</code> dstar make variables. Archives created with the <code>archive-publish</code> action will also <b>not</b> include any intermediate build files, so it should be much smaller in size than those created by the <a href="#archive-build">&quot;archive-build&quot;</a> action. Unlike an <a href="#archive-build">&quot;archive-build&quot;</a> archive however, an <code>archive-publish</code> archive cannot be used as the basis for subsequent subsequent <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Incremental-Update">incremental corpus updates</a> or infrastructure maintainence; please <a href="#build-responsibly">act responsibly</a>.</p>

</dd>
<dt id="install">install</dt>
<dd>

<p>Installs an existing corpus index from <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> to <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/{server,web}/</code> within the running <code>dstar-buildhost</code> container, usually in preparation for <a href="#MYCORPUS-staging">local staging</a>. See also <a href="#uninstall">&quot;uninstall&quot;</a>.</p>

</dd>
<dt id="uninstall">uninstall</dt>
<dd>

<p>Recursively removes corpus runtime data directories <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/{server,web}/</code>, recommended after <a href="#MYCORPUS-staging">local staging</a>. This action will remove <b>everything</b> under <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/{server,web}/</code>, so if you&#39;ve stored anything there yourself, you should save it before executing this action.</p>

</dd>
<dt id="publish">publish</dt>
<dd>

<p>Deploy an existing corpus index from <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> to production host(s) as selected by the dstar make variables <code>PUBLISH_DEST</code> and/or <code>WEB_PUBLISH_DEST</code>.</p>

</dd>
<dt id="run">run</dt>
<dd>

<p>Runs a <a href="#c-CORPUS"><code>CORPUS</code></a> instance from <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/{server,web}/</code> in the temporary container. For this action, you will probably also want to specify <a href="#p-HTTP_PORT"><code>-p HTTP_PORT</code></a>. If specified, this must be the last container action executed.</p>

<p>You can inspect the console log for the embedded container with the <a href="https://docs.docker.com/engine/reference/commandline/logs/"><code>docker logs</code></a> command.</p>

</dd>
<dt id="shell">shell</dt>
<dd>

<p>Runs a <code>bash</code> shell as the <a href="#u-USER">build user</a> in the embedded container; useful for inspection and debugging.</p>

</dd>
<dt id="exec-CMD">exec CMD</dt>
<dd>

<p>Just executes <code>CMD...</code> in the embedded container. If specified, this must be the final container action executed. Use with <b>extreme caution</b>.</p>

</dd>
</dl>

<h2 id="Container-Environment-Variables">Container Environment Variables</h2>

<p>The following environment variables influence operations in the embedded <code>dstar-buildhost</code> container, and can be customized by means of the gantry <a href="#e-VAR-VALUE">&quot;-e VAR=VALUE&quot;</a> and/or <a href="#E-ENV_FILE">&quot;-E ENV_FILE&quot;</a> options.</p>

<dl>

<dt id="SSH_AUTH_SOCK">SSH_AUTH_SOCK</dt>
<dd>

<p>The communication socket for <a href="#ssh-agent">ssh-agent</a> on the docker host will be bind-mounted into the container as <code>/tmp/ssh-auth-gantry.sock</code>. The embedded <code>/dstar/docker/build</code> script will typically take care of wrapping that socket as <code>/tmp/ssh-agent-wrap.sock</code>, to ensure appropriate permissions for the build <a href="#u-USER">USER</a> and <a href="#g-GROUP">GROUP</a> within the container itself.</p>

</dd>
<dt id="dstar_init_hooks">dstar_init_hooks</dt>
<dd>

<p>Default initialization hook directory for the embedded <code>/dstar/docker/build</code> script; typically empty. If you need to perform additional actions on the container startup, you can set this variable to the container path of a (mounted) directory containing hooks appropriate for the <a href="https://manpages.debian.org/buster/debianutils/run-parts.8.en.html"><code>run-parts</code></a> system utility. If no <code>INIT_HOOK_DIR(s)</code> are specified on the command-line or by this environment variable, hooks are run from any directory matching</p>

<pre><code> /home/ddc-dstar/dstar/docker/build.d/
 /opt/dstar-build*/</code></pre>

</dd>
<dt id="dstar_build_uid">dstar_build_uid</dt>
<dd>

<p>Numeric UID of build user; should be automatically populated by gantry from the <a href="#u-USER">&quot;-u USER&quot;</a> option. If no user with this UID exists in the container (likely), a temporary user <code>dstar-build</code> will be created during container startup.</p>

</dd>
<dt id="dstar_build_gid">dstar_build_gid</dt>
<dd>

<p>Numeric GID of build group; should be automatically populated by gantry from the <a href="#g-GROUP">&quot;-g GROUP&quot;</a> option. If no group with this GID exists in the container (likely), a temporary group <code>dstar-build</code> will be created during container startup and the <code><a href="#dstar_build_uid">dstar_build_uid</a></code> user approrpriately modified.</p>

</dd>
<dt id="dstar_build_umask">dstar_build_umask</dt>
<dd>

<p>Specifies the permissions umask for the build process. The default is typically specified in the <code>dstar-buildhost</code> docker image itself as <code>002</code>, which creates new files with the group-writable flag set. If you&#39;re feeling paranoid, you can set this to <code>022</code> or even <code>077</code>, but that may cause <a href="#E000013-...-Permission-denied">problems down the line</a>.</p>

</dd>
<dt id="dstar_corpora">dstar_corpora</dt>
<dd>

<p>Specifies the corpus or corpora to operate on as a whitespace-separated list. Typcically set by <code>dstar-gantry.sh</code> itself to <a href="#c-CORPUS"><code>CORPUS</code></a>. You probably don&#39;t want to set this yourself.</p>

</dd>
<dt id="dstar_corpus">dstar_corpus</dt>
<dd>

<p>Alias for <a href="#dstar_corpora">&quot;dstar_corpora&quot;</a>.</p>

</dd>
<dt id="dstar_archive_dir">dstar_archive_dir</dt>
<dd>

<p>Target directory for <a href="#archive-build">&quot;archive-build&quot;</a> and <a href="#archive-publish">&quot;archive-publish&quot;</a> actions. Empty (unset) by default.</p>

</dd>
<dt id="dstar_sync_resources">dstar_sync_resources</dt>
<dd>

<p>Whether or not to synchronize CAB resources to <a href="#R-RESOURCES_DIR"><code>RESOURCES_DIR</code></a> on container startup. Accepts values <code>auto</code> (default), <code>no</code>, and <code>force</code>. The default value (<code>auto</code>) will only attempt to synchronize resources if <a href="#R-RESOURCES_DIR"><code>RESOURCES_DIR</code></a> is not mounted <a href="#RO">read-only</a>.</p>

</dd>
<dt id="dstar_sync_rcfiles">dstar_sync_rcfiles</dt>
<dd>

<p>Specifies which CAB resources in <a href="#R-RESOURCES_DIR"><code>RESOURCES_DIR</code></a> are to by synchronized on container startup. If set and non-empty, overrides that value of the dstar make variable <code>CABRC_FILES</code> for the implicit <code>make -C /dstar/resources sync</code> syncronization call. Empty by default, which uses the default value for <code>CABRC_FILES</code>, and should cause all default CAB resources to be synchronized.</p>

</dd>
<dt id="dstar_checkout_corpus_opts">dstar_checkout_corpus_opts</dt>
<dd>

<p>Specifies options for <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Checkout"><code>dstar-checkout-corpus.sh</code></a> as implicitly called prior to any corpus operation. Default: <code>-force -local-config</code>.</p>

</dd>
<dt id="dstar_build_sh_opts">dstar_build_sh_opts</dt>
<dd>

<p>Specifies options for <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh-and-cron-autobuild.sh"><code>CORPUS_ROOT/build/build.sh -build</code></a>. Default: <code>-echo-preset=make-info</code>.</p>

</dd>
<dt id="dstar_cabx_run">dstar_cabx_run</dt>
<dd>

<p>Specifies which CAB server(s) to start in the container for the <a href="#run">&quot;run&quot;</a> action as a whitespace-separated list. CAB server(s) are identified by the file basename up to the first dot (&quot;.&quot;) of the corresponding configuration file <code>/dstar/cabx/*.rc</code>. Default: <code>dstar-http-9096</code>. Known values:</p>

<pre><code> dstar-http-9096       - runtime expansion for synchronic German
 dstar-http-dta-8088   - runtime expansion for historical German
 dstar-http-dta-9099   - &quot;public&quot; web-service for historical German
 dstar-http-en-9097    - runtime expansion for synchronic English
 dstar-http-taghx-9098 - runtime lemma-equivalence using TAGH</code></pre>

</dd>
<dt id="dstar_relay_conf">dstar_relay_conf</dt>
<dd>

<p>Specifies container path containing <a href="https://linux.die.net/man/1/socat"><code>socat</code></a> relay configuration for <code>/dstar/init/dstar-relay.sh</code>. Empty by default, which starts no relays. This option is useful for workstations with insufficient resources to run embedded <a href="#dstar_cabx_run">CAB expansion servers</a> locally, or in situations where <a href="#R-RESOURCES_DIR"><code>RESOURCES_DIR</code></a> is not fully populated in order to bind &quot;virtual&quot; local ports which forward all requests to a remote server daemon (e.g. <code>data.dwds.de:9096</code> for the CAB expansion server <code>dstar-http-9096</code>). It can also be useful for testing &quot;metacorpora&quot; in a container without having to run all daughter corpora in the container as well; in this case, relays should be defined for each immediate daughter node of the metacorpus to be run.</p>

<p>See <a href="http://svn.dwds.de/websvn/filedetails.php?repname=D%2A%3A+Dev-Repository&amp;path=%2Fddc-dstar%2Ftrunk%2Finit%2Fetc_default_dstar_relay"><code>dstar-buildhost:/dstar/init/etc_default_dstar_relay</code></a> for syntax and more details.</p>

</dd>
<dt id="VAR">VAR</dt>
<dd>

<p>All environment variables are passed down to child processes (e.g. <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#dstar-nice-sh"><code>dstar-nice.sh</code></a>, <code>make</code>); see <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Customizable-Variables">&quot;Customizable Variables&quot; in <code>README_build.txt</code></a> for more (non-exhaustive) details.</p>

</dd>
</dl>

<h1 id="EXAMPLES">EXAMPLES</h1>

<p>This section provides rudimentary sketches of some typical dstar corpus operations using <code>dstar-gantry.sh</code>. Since <code>dstar-gantry</code> is basically just a convenience wrapper around the <code>ddc-dstar</code> corpus infrastructure, most of the existing <a href="https://kaskade.dwds.de/dstar/doc/">dstar documentation</a> applies to <code>dstar-gantry</code> as well, where the <a href="https://kaskade.dwds.de/dstar/doc/README.html#BUILDHOST"><code>DSTAR_BUILDHOST</code></a> role is fulfilled by the embedded embedded <a href="#i-IMAGE"><code>dstar-buildhost</code> IMAGE</a> container, and the corpus directories <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> and <a href="#S-CORPUS_SRC"><code>CORPUS_SRC</code></a> are bind-mounted into the container from the gantry host itself.</p>

<p>The examples in this section assume you have a working <code>dstar-gantry</code> installation in your <code>$PATH</code> and a sparse local <a href="#d-DSTAR_ROOT"><code>DSTAR_ROOT</code></a> directory or symlink at <code>$HOME/dstar</code>. See <a href="#INSTALLATION">&quot;INSTALLATION&quot;</a> if that is not the case.</p>

<p>Corpus-specific examples assume you are working on a corpus called &quot;<code>MYCORPUS</code>&quot;; replace &quot;<code>MYCORPUS</code>&quot; with the name of your real corpus where appropriate.</p>

<h2 id="Common-Prerequisites">Common Prerequisites</h2>

<p>In addition to a working <a href="#INSTALLATION">gantry installation</a>, you should typically do the following performing any corpus operation:</p>

<dl>

<dt id="Pull-and-Synchronize">Pull and Synchronize</dt>
<dd>

<pre><code> $ dstar-gantry.sh pull sync</code></pre>

<p>Ensure your host&#39;s <a href="#d-DSTAR_ROOT"><code>DSTAR_ROOT</code></a>, gantry installation, and <a href="#i-IMAGE"><code>dstar-buildhost</code> image</a> are up-to-date with the <a href="#sync"><code>sync</code></a> and <a href="#pull"><code>pull</code></a> actions.</p>

</dd>
<dt id="Setup-Corpus-Sources">Setup Corpus Sources</dt>
<dd>

<pre><code> $ ln -s /path/to/real/MYCORPUS/tei-xml/sources ~/dstar/sources/MYCORPUS</code></pre>

<p>You presumably have some TEI-XML corpus sources on which you wish to operate; these should follow the guidelines in <a href="https://kaskade.dwds.de/dstar/doc/README_sources.html"><code>dstar/doc/README_sources</code></a>. If you want to avoid having to specify the gantry <a href="#S-CORPUS_SRC">&quot;-S CORPUS_SRC&quot;</a> option for every <code>dstar-gantry.sh</code> call, you should symlink the location of the &quot;real&quot; sources into your <a href="#d-DSTAR_ROOT"><code>DSTAR_ROOT</code></a> checkout at <code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a>/sources/MYCORPUS</code>. See also <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Sources">&quot;Corpus Sources&quot; in the dstar-HOWTO</a> and <a href="https://kaskade.dwds.de/dstar/doc/README_sources.html">README_sources.txt</a>.</p>

</dd>
<dt id="Setup-Corpus-Configuration">Setup Corpus Configuration</dt>
<dd>

<p>You will need provide a configuration (<code>MYCORPUS.mak</code> and <code>MYCORPUS.opt</code>) for your corpus as described under <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Configuration">&quot;Corpus Configuration&quot; in the dstar-HOWTO</a> and under <a href="https://kaskade.dwds.de/dstar/doc/talks/corpus-ops-2019/#howto-config">&quot;HOWTO: Corpus Configuration&quot; in the dstar corpus operations slides</a>. Since the default <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#DSTAR_CONFIG"><code>DSTAR_CONFIG</code></a> for dstar-gantry builds resides by default in the embedded <code>dstar-buildhost</code> container, you may want to provide the corpus configuration by creating a <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Corpus-specific-customizations-with-config.local"><code>CORPUS_ROOT/config.local/</code></a> directory; otherwise you will have to commit the corpus configuration files to SVN under <a href="https://kaskade.dwds.de/dstar/doc/README.html#config"><code>DSTAR_ROOT/config/</code></a> before proceeding. It should be safe to use <a href="#d-DSTAR_ROOT">gantry&#39;s sparse DSTAR_ROOT</a> for this purpose, but note that you will first have to check it out (gantry doesn&#39;t require or checkout <code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a>/config/</code> by default):</p>

<pre><code> $ svn update --set-depth=infinity ~/dstar/config
 $ emacs \
    ~/dstar/config/corpus/MYCORPUS.mak \
    ~/dstar/config/opt/MYCORPUS.opt \
    ~/dstar/doc/Changes.txt
 $ svn add ~/dstar/config/*/MYCORPUS.*
 $ svn commit -m &quot;+ added and/or updated corpus configuration for MYCORPUS&quot; \
    ~/dstar/config/*/MYCORPUS.* \
    ~/dstar/doc/Changes.txt</code></pre>

<p>If you choose to use a global configuration in your sparse <code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a>/config/</code>, you will probably want to <a href="#v-PATH:-MOUNT">mount it as a volume</a> in the embedded container by specifying &quot;<code>-v $DSTAR_ROOT/config:/dstar/config:ro</code>&quot; on the gantry command-line.</p>

</dd>
</dl>

<h2 id="Example:-Corpus-Build">Example: Corpus Build</h2>

<p>Before attempting to (re-)build a corpus, you should ensure that you have fulfilled all the <a href="#Common-Prerequisites">&quot;Common Prerequisites&quot;</a>.</p>

<dl>

<dt id="MYCORPUS-build">MYCORPUS build</dt>
<dd>

<pre><code> $ dstar-gantry.sh -bg -c MYCORPUS build</code></pre>

<p>Building a corpus index from TEI-XML sources or re-building an existing corpus index with the gantry <a href="#build"><code>build</code></a> action follows the basic pattern described under <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Annotate-and-Build">&quot;Annotate and Build&quot; in the dstar-HOWTO</a> using <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#dstar-checkout-corpus.sh"><code>dstar-checkout-corpus.sh</code></a> to populate or update the <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> checkout and calling <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh"><code>/dstar/corpora/MYCORPUS/build.sh -build</code></a> in the in the embedded <a href="#i-IMAGE"><code>dstar-buildhost</code></a> container. By default, full <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Build-Logging">build-logs</a> will be written to <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/log/build.<i>DATETIME</i>.log</code>, and some progress information will be printed to the console via <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#cronit.perl"><code>cronit.perl -echo-preset=make-info</code></a>. See <a href="https://kaskade.dwds.de/dstar/doc/README_build.html">README_build</a> for more details on the build process.</p>

</dd>
<dt id="MYCORPUS-consistency-testing">MYCORPUS consistency testing</dt>
<dd>

<pre><code> $ dstar-gantry.sh -RO -c MYCORPUS test</code></pre>

<p>Once a corpus index has been succesfully <a href="#build">built</a>, you can run some basic consistency checks with the gantry <a href="#test">test</a> action; see <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Consistency-Tests">&quot;Consistency Testing&quot; in the dstar-HOWTO</a> for more information. By default, full <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Build-Logging">test-logs</a> will be written to <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/log/test.<i>DATETIME</i>.log</code>, and some progress information will be printed to the console.</p>

</dd>
<dt id="MYCORPUS-staging">MYCORPUS staging</dt>
<dd>

<pre><code> $ dstar-gantry.sh -bg -p 8001 -RO -c MYCORPUS install run
 $ sensible-browser http://localhost:8001/dstar/MYCORPUS
 ... do some manual testing ...
 $ docker kill dstar-gantry-MYCORPUS
 $ dstar-gantry.sh -RO -c MYCORPUS uninstall</code></pre>

<p>Once a corpus index has been succesfully <a href="#build">built</a>, you can use <code>dstar-gantry.sh</code> to <a href="#install">install</a> and <a href="#run">run</a> a staging&quot; instance of the dstar <a href="https://kaskade.dwds.de/dstar/doc/README.html#Hosts-and-Roles"><code>RUNHOST</code> and <code>WEBHOST</code> roles</a> for that corpus in the embedded <code>dstar-buildhost</code> container, analogous to (but independent of) the <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Sandbox-Testing">&quot;Sandbox Testing&quot;</a> functionality for &quot;bare-metal&quot; dstar corpus builds. You only need to <a href="#install">&quot;install&quot;</a> if you have updated corpus index data in the <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code> directory, e.g. via the <a href="#build">&quot;build&quot;</a>, <a href="#update">&quot;update&quot;</a>, or <a href="#update-meta">&quot;update-meta&quot;</a> operations); you can re-stage an existing <a href="#install">installation</a> with the gantry <a href="#run">&quot;run&quot;</a> action.</p>

<p>Use the gantry <a href="#p-HTTP_PORT">-p HTTP_PORT</a> option to specify a host port number to map to the embedded HTTP server, and use the gantry <a href="#fg--bg"><code>-bg</code></a> or <a href="https://docs.docker.com/engine/reference/run/#detached--d"><code>docker run -d</code></a> option to run the embedded container in the background. When you are done with manual testing, remember to terminate the running container with <a href="https://docs.docker.com/engine/reference/commandline/kill/"><code>docker kill</code></a> It is also good practice to <a href="#uninstall">&quot;uninstall&quot;</a> the runtime data when you are done with the staging instance.</p>

<p>If you are running dstar-gantry on a <a href="https://kaskade.dwds.de/dstar/doc/README.html#GANTRYHOST"><code>GANTRYHOST</code></a> behind a firewall and you wish to call your browser on a different machine (let&#39;s call it <code>WORKSTATION</code>), you may need to setup an <a href="https://www.ssh.com/ssh/tunneling/example">ssh tunnel</a> to the remote port, and shut it down again when you&#39;re finished with the staging instance. This can be accomplished by e.g.:</p>

<pre><code> GANTRYHOST  $ dstar-gantry.sh -RO -bg -p 8001 -c MYCORPUS install run
 WORKSTATION $ ssh 8002:GANTRYHOST:8001 -N GANTRYHOST &amp; gantry_tunnel_pid=$!
 WORKSTATION $ sensible-browser http://localhost:8002/dstar/MYCORPUS

 ... do some manual testing &amp; inspection in your browser ...

 WORKSTATION $ kill $gantry_tunnel_pid
 GANTRYHOST  $ docker kill dstar-gantry-MYCORPUS
 GANTRYHOST  $ dstar-gantry.sh -RO -c MYCORPUS uninstall</code></pre>

<p>... replace <code>8001</code> in the above example with an <a href="#p-HTTP_PORT"><code>HTTP_PORT</code></a> of your choice to be bound by the container on <code>GANTRYHOST</code>, and replace <code>8002</code> with a port number of your choice to be bound by the ssh-tunnel on <code>WORKSTATION</code>.</p>

</dd>
<dt id="MYCORPUS-deployment">MYCORPUS deployment</dt>
<dd>

<pre><code> $ dstar-gantry.sh -RO -c MYCORPUS publish</code></pre>

<p>If the corpus build is satisfactory, the next step is usually to install the newly indexed corpus onto the production <a href="https://kaskade.dwds.de/dstar/doc/README.html#Hosts-and-Roles"><code>RUNHOST</code> and <code>WEBHOST</code></a>. The <code>dstar-gantry</code> &quot;<a href="#publish">&quot;publish&quot;</a>&quot; action follows the pattern described under <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Install-or-Publish">&quot;Install or Publish&quot; in the dstar-HOWTO</a>, using <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#dstar-checkout-corpus.sh"><code>dstar-checkout-corpus.sh</code></a> to populate and/or update the <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Runtime-Checkouts">runtime checkous</a> by calling <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh-and-cron-autobuild.sh"><code>CORPUS_ROOT/build/build.sh -publish</code></a> in the embedded <a href="#i-IMAGE"><code>dstar-buildhost</code></a> container. By default, full <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Build-Logging">publish-logs</a> will be written to <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/log/publish.<i>DATETIME</i>.log</code>, and some progress information will be printed to the console.</p>

</dd>
<dt id="MYCORPUS-post-deployment">MYCORPUS post-deployment</dt>
<dd>

<p>If the deployment is successful, continue with the procedures described under <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Its-Alive">&quot;It&#39;s Alive&quot;</a>, <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Nail-it-Down">&quot;Nail it Down&quot;</a>, and (optionally) <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Housekeeping">&quot;Housekeeping&quot;</a> in the <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html">dstar-HOWTO</a>. In particular, if you have deployed a &quot;production&quot; corpus which was configured by means of a <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Corpus-specific-customizations-with-config.local"><code>CORPUS_ROOT/config.local/</code></a> directory, you should ensure that the <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Configuration">Corpus configuration file(s)</a> from <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/config.local/</code> are checked into the central <a href="https://kaskade.dwds.de/dstar/doc/README.html#config"><code>ddc-dstar/trunk/config</code></a> repository, and document your changes in <a href="https://kaskade.dwds.de/dstar/doc/Changes.html"><code>DSTAR_ROOT/doc/Changes.txt</code></a>.</p>

</dd>
</dl>

<h2 id="Example:-Corpus-Update">Example: Corpus Update</h2>

<p>Before attempting to update a corpus, you should ensure that you have fulfilled all the <a href="#Common-Prerequisites">&quot;Common Prerequisites&quot;</a>, and that you have an up-to-date instance of the <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> checkout -- including any intermediate build data -- on the gantry host, typically under <code><a href="#d-DSTAR_ROOT">DSTAR_ROOT</a>/corpora/MYCORPUS</code>.</p>

<dl>

<dt id="MYCORPUS-update">MYCORPUS update</dt>
<dd>

<pre><code> $ dstar-gantry.sh -bg -c MYCORPUS update</code></pre>

<p>Updating an existing corpus index after some source file(s) have been changed, added, and/or deleted by means of the gantry <a href="#update">update</a> action follows the basic pattern described under <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Incremental-Update">&quot;Incremental Update&quot; in <code>README_build.txt</code></a>. The gantry <a href="#update">update</a> action uses uses <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#dstar-checkout-corpus.sh"><code>dstar-checkout-corpus.sh</code></a> to update the existing <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> superstructure, and calls <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh"><code>CORPUS_ROOT/build/build.sh -update</code></a> in the in the embedded <a href="#i-IMAGE"><code>dstar-buildhost</code></a> container to perform the index update. By default, full <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Build-Logging">build-logs</a> will be written to <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/log/update.<i>DATETIME</i>.log</code>, and some progress information will be printed to the console via <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#cronit.perl"><code>cronit.perl -echo-preset=make-info</code></a>. See <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Incremental-Update">&quot;Incremental Update&quot; in <code>README_build.txt</code></a> for more details.</p>

</dd>
<dt id="MYCORPUS-post-update">MYCORPUS post-update</dt>
<dd>

<p>After updating a corpus with the <a href="#update">update</a> action, proceed as you would after a <a href="#build">build</a> action, i.e. with <a href="#MYCORPUS-consistency-testing">consistency testing</a>, <a href="#MYCORPUS-staging">staging</a>, <a href="#MYCORPUS-deployment">deployment</a>, and <a href="#MYCORPUS-post-deployment">post-deployment</a>.</p>

</dd>
</dl>

<h2 id="Example:-Corpus-Metadata-Update">Example: Corpus Metadata Update</h2>

<p>Before attempting to update corpus metadata, you should ensure that you have fulfilled all the <a href="#Common-Prerequisites">&quot;Common Prerequisites&quot;</a>, and that you have an up-to-date instance of the <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> checkout -- including any intermediate build data -- on the gantry host, typically under <code>DSTAR_ROOT/corpora/MYCORPUS</code>.</p>

<dl>

<dt id="MYCORPUS-metadata-update">MYCORPUS metadata-update</dt>
<dd>

<pre><code> $ dstar-gantry.sh -RO -bg -c MYCORPUS update-meta</code></pre>

<p>Updating metadata for an existing corpus index after some source file(s) have been changed, added, and/or deleted by means of the gantry <a href="#update-meta">update-meta</a> action follows the basic pattern described under <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Metadata-Update">&quot;Metadata Update&quot; in <code>README_build.txt</code></a>. The gantry <a href="#update-meta">update-update</a> action uses uses <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#dstar-checkout-corpus.sh"><code>dstar-checkout-corpus.sh</code></a> to update the existing <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> superstructure, and calls <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#build.sh"><code>/dstar/corpora/MYCORPUS/build.sh -update-meta</code></a> in the in the embedded <a href="#i-IMAGE"><code>dstar-buildhost</code></a> container to perform the index metadata update. By default, full <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Build-Logging">build-logs</a> will be written to <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/log/update-meta.<i>DATETIME</i>.log</code>, and some progress information will be printed to the console via <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#cronit.perl"><code>cronit.perl -echo-preset=make-info</code></a>. See <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Metadata-Update">&quot;Metadata Update&quot; in <code>README_build.txt</code></a> for more details.</p>

</dd>
<dt id="MYCORPUS-post-metadata-update">MYCORPUS post-metadata-update</dt>
<dd>

<p>After updating a corpus with the <a href="#update-meta">update-meta</a> action, proceed as you would after a <a href="#build">build</a> action, i.e. with <a href="#MYCORPUS-consistency-testing">consistency testing</a>, <a href="#MYCORPUS-staging">staging</a>, <a href="#MYCORPUS-deployment">deployment</a>, and <a href="#MYCORPUS-post-deployment">post-deployment</a>.</p>

</dd>
</dl>

<h2 id="Example:-Corpus-Build-Archive">Example: Corpus Build Archive</h2>

<dl>

<dt id="MYCORPUS-build-archive">MYCORPUS build archive</dt>
<dd>

<pre><code> $ dstar-gantry.sh -RO -c pnn_test archive-build
 $ rm -rf ~/dstar/corpora/pnn_test/{build,server,web}</code></pre>

<p>If your <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT/build/</code></a> directory is taking up too much space after <a href="#publish">deployment</a> and doesn&#39;t participate in any <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Superordinate-Metacorpora">superordinate metacorpora</a>, <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Incremental-Update">incremental updates</a>, or other operations requiring access to intermediate build files, then you may want to archive it and remove the original <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> on the gantry host to save disk space (... but take care not to remove the archive while doing so). You can use the gantry <a href="#archive-build"><code>arhive-build</code></a> action for this purpose, which creates a gzipped tar archive <code>${dstar_archive_dir}/MYCORPUS.build-<i>DATETIME</i>.tar.gz</code>, where <i>DATETIME</i> is a timestamp in <i>YYYY-MM-DD.HHMMSS</i> format and <code>${dstar_archive_dir}</code> is a <a href="#e-VAR-VALUE">container environment variable</a>, by default <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/archive/</code>.</p>

</dd>
<dt id="MYCORPUS-build-archive-restoration">MYCORPUS build archive restoration</dt>
<dd>

<p>If you want to restore an archived corpus build directory, just unpack the archive file back into the <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> directory:</p>

<pre><code> $ cd ~/dstar/corpora/MYCORPUS/archive
 $ tar xzf MYCORPUS.build-DATETIME.tar.gz -C ..</code></pre>

</dd>
</dl>

<h2 id="Example:-Corpus-Deployment-Archive">Example: Corpus Deployment Archive</h2>

<dl>

<dt id="MYCORPUS-deployment-archive">MYCORPUS deployment archive</dt>
<dd>

<pre><code> $ dstar-gantry.sh -RO -c pnn_test archive-publish
 $ rm -rf ~/dstar/corpora/pnn_test/{server,web}</code></pre>

<p>You can create a &quot;snapshot&quot; of publishable corpus data from a <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT/build/</code></a> directory by means of the gantry <a href="#archive-publish">&quot;archive-publish&quot;</a> action. The resulting archive will be created as <code>${dstar_archive_dir}/MYCORPUS.publish-<i>DATETIME</i>.tar.gz</code>, where <i>DATETIME</i> is a timestamp in <i>YYYY-MM-DD.HHMMSS</i> format and <code>${dstar_archive_dir}</code> is a <a href="#e-VAR-VALUE">container environment variable</a>, by default <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/archive/</code>, and should contain all the index data required for a production runtime corpus instance on <a href="https://kaskade.dwds.de/dstar/doc/README.html#Hosts-and-Roles"><code>RUNHOST</code> and/or <code>WEBHOST</code></a>.</p>

</dd>
<dt id="MYCORPUS-deployment-archive-restoration">MYCORPUS deployment archive restoration</dt>
<dd>

<p>If you want to restore an archived corpus deployment snapshot, just unpack the archive file back into the <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT/build/</code></a> directory:</p>

<pre><code> $ cd ~/dstar/corpora/MYCORPUS/archive
 $ tar xzf MYCORPUS.publish-DATETIME.tar.gz -C ../build</code></pre>

<p>To re-deploy the restored archive data to runtime &quot;production&quot; hosts, you should follow this up with a <a href="#publish">&quot;publish&quot;</a> operation.</p>

</dd>
</dl>

<h2 id="Example:-Corpus-Removal">Example: Corpus Removal</h2>

<p><code>dstar-gantry</code> does not currently provide any shortcuts for removing an existing corpus, but it is straightforward to do by hand.</p>

<dl>

<dt id="MYCORPUS-gantry-host-removal">MYCORPUS gantry host removal</dt>
<dd>

<pre><code> $ rm -rf ~/dstar/corpora/MYCORPUS/{build,server,web}</code></pre>

<p>To remove all corpus <a href="#build">build</a> and <a href="#MYCORPUS-staging">staging</a> data, simply delete the relevant subdirectories from the gantry host. This will remove all dstar data created by the gantry actions <a href="#build">&quot;build&quot;</a>, <a href="#update">&quot;update&quot;</a>, <a href="#install">&quot;install&quot;</a>, etc., including intermediate build files. If you have created any <a href="#archive-build">build-</a> and/or <a href="#archive-publish">publish-</a>archives under <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/archive/</code> which you want to save, you may want to move them to a different location (e.g. <code>$HOME/attic/</code>):</p>

<pre><code> $ mv ~/dstar/corpora/MYCORPUS/archive/*.tar.gz ~/attic/</code></pre>

<p>Otherwise, or if you wish to delete any old archives under under <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/archive/</code>, you can delete the entire <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a></code> directory:</p>

<pre><code> $ rm -rf ~/dstar/corpora/MYCORPUS/</code></pre>

</dd>
<dt id="MYCORPUS-decommissioning">MYCORPUS decommissioning</dt>
<dd>

<p>To decommission (&quot;un-deploy&quot;) a corpus instance which has already been deployed to a runtime &quot;production&quot; <a href="https://kaskade.dwds.de/dstar/doc/README.html#RUNHOST"><code>RUNHOST</code></a> and/or <a href="https://kaskade.dwds.de/dstar/doc/README.html#WEBHOST"><code>WEBHOST</code></a>, follow the general procedure described under <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Removal">&quot;Corpus Removal&quot; in the dstar-HOWTO</a>, where the gantry host acts as the <code>BUILDHOST</code>, so <a href="#MYCORPUS-gantry-host-removal">gantry host removal</a> replaces the <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Freeze-or-remove-build-data-optional">&quot;Freeze or remove build data&quot;</a> step in the general HOWTO.</p>

</dd>
</dl>

<h1 id="CAVEATS">CAVEATS</h1>

<h2 id="docker-storage-drivers">docker storage drivers</h2>

<p>Problems with runtime cross-layer copy operations have been observed in the past when using the <code>overlay2</code> docker storage driver, which is the default in recent version of the <code>docker-ce</code> package. On systems where these problems occurred, the <code>aufs</code> docker storage driver did not exhibit these issues; see <a href="https://docs.docker.com/storage/storagedriver/aufs-driver/">https://docs.docker.com/storage/storagedriver/aufs-driver/</a> for details.</p>

<p>Even more recent debian releases no longer contain the <code>aufs</code> storage driver. The <code>overlay2</code> storage driver appears to work correctly under Debian 10 (&quot;buster&quot;) using <code>docker-ce-5:19.03.12~3-0~debian-buster</code> (&quot;Docker Community Edition&quot;, version 19.03.12) and linux kernel version 4.19.0-6-amd64.</p>

<p>It is currently recommended to try the default storage driver for your docker installation (probably <code>overlay2</code>), and only switch to <code>aufs</code> if you experience issues with cross-layer copy operations.</p>

<p>Typically, the <code>aufs</code> driver can be enabled by editing the file <i>/etc/docker/daemon.json</i> to contain:</p>

<pre><code> {
  &quot;storage-driver&quot;:&quot;aufs&quot;
 }</code></pre>

<p>... and re-starting any docker services on the host machine.</p>

<h2 id="build-responsibly">build responsibly</h2>

<p>If you build a corpus with <code>dstar-gantry</code> in a non-standard location and/or on a non-production host, you implicitly assume all resonsibility for keeping track of the intermediate build files in <code><a href="#C-CORPUS_ROOT">CORPUS_ROOT</a>/build/</code>. Deploying only a corpus runtime instance to &quot;production&quot; hosts by means of the <a href="#publish">&quot;publish&quot;</a> action is <b>not</b> sufficient to enable subsequent <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Incremental-Update">incremental corpus updates</a>, integration of new dstar functionality, or to enable many bug-fixes. You are free to delete or archive corpus build directories once you&#39;re done with them, but this is likely to make more work for everyone (yourself included) down the road. Consider <a href="#MYCORPUS-build-archive">archiving the corpus build directory</a> if you need to save disk space.</p>

<h2 id="log-changes">log changes</h2>

<p>When making changes to a corpus configuration in SVN, remember to log any changes to <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#doc%2FChanges.txt"><code>DSTAR_ROOT/doc/Changes.txt</code></a>. If you are using a <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#Corpus-specific-customizations-with-config.local"><code>CORPUS_ROOT/config.local/</code></a> directory for corpus configuration outside of version control, remember to <a href="#build-responsibly">&quot;build responsibly&quot;</a>, and seriously consider checking the final configuration into version control.</p>

<h1 id="KNOWN-BUGS-AND-COMMON-ERRORS">KNOWN BUGS AND COMMON ERRORS</h1>

<dl>

<dt id="Error-response-from-daemon:-...-no-basic-auth-credentials">Error response from daemon: ... no basic auth credentials</dt>
<dd>

<pre><code> dstar-gantry.sh: CMD: docker pull lex.dwds.de:443/dstar/dstar-buildhost:latest
 Error response from daemon: Get https://lex.dwds.de:443/v2/dstar/dstar-buildhost/manifests/latest: no basic auth credentials
 dstar-gantry.sh: ERROR: command `docker pull lex.dwds.de:443/dstar/dstar-buildhost:latest` exited abnormally with status 1</code></pre>

<p>This error can occur when executing a <a href="#pull"><code>gantry pull</code></a> if you neglected to run <code>docker login</code> for the ZDL docker registry. See <a href="#registry-credentials">&quot;registry credentials&quot;</a>.</p>

</dd>
<dt id="WARNING:-neither-CORPUS-nor-CORPUS_ROOT-specified">WARNING: neither CORPUS nor CORPUS_ROOT specified</dt>
<dd>

<pre><code> dstar-gantry.sh: WARNING: neither CORPUS nor CORPUS_ROOT specified (use the -c or -C options)</code></pre>

<p>This warning message usually indicates that you forgot to specify either a corpus label with the <a href="#c-CORPUS">&quot;-c CORPUS&quot;</a> option or a corpus root directory with the <a href="#C-CORPUS_ROOT">&quot;-C CORPUS_ROOT&quot;</a> option. In this case, any corpus-dependent operation such as <a href="#build">&quot;build&quot;</a>, <a href="#test">&quot;test&quot;</a>, etc. is likely to fail ... unless you have set appropriate <a href="#Container-Environment-Variables">container variables</a> such as <a href="#dstar_corpora">&quot;dstar_corpora&quot;</a> with the <a href="#e-VAR-VALUE">&quot;-e VAR=VALUE&quot;</a> option and volume mounts with the <a href="#v-PATH:-MOUNT">&quot;-v /PATH:/MOUNT&quot;</a> option. If the requested <a href="#Gantry-Actions">gantry action</a> is not a corpus-dependent operation (e.g. <a href="#shell">&quot;shell&quot;</a>), you can ignore this warning.</p>

</dd>
<dt id="WARNING:-no-CORPUS_SRC-directory-specified">WARNING: no CORPUS_SRC directory specified</dt>
<dd>

<pre><code> dstar-gantry.sh: WARNING: no CORPUS_SRC directory specified (expect trouble if you&#39;re trying to (re-)index a corpus)</code></pre>

<p>This warning message indicates that <code>dstar-gantry.sh</code> could not locate a <a href="#S-CORPUS_SRC">corpus source directory</a> in any of the default locations, and that you haven&#39;t specified one with the <a href="#S-CORPUS_SRC">&quot;-S CORPUS_SRC&quot;</a> option. Source-dependent operations such as <a href="#build">&quot;build&quot;</a>, <a href="#update">&quot;update&quot;</a>, and <a href="#update-meta">&quot;update-meta&quot;</a> are likely to fail unless you specify additional <a href="#Container-Environment-Variables">container variables</a> and/or <a href="#v-PATH:-MOUNT">volume mounts</a>.</p>

<p>If the requested <a href="#Gantry-Actions">gantry action</a> is a source-independent operation such as <a href="#install">&quot;install&quot;</a>, <a href="#publish">&quot;publish&quot;</a>, or <a href="#run">&quot;run&quot;</a>, you can ignore this warning.</p>

</dd>
<dt id="Conflict.-The-container-name-dstar-gantry-MYCORPUS-is-already-in-use">Conflict. The container name &quot;/dstar-gantry-MYCORPUS&quot; is already in use</dt>
<dd>

<pre><code> docker:
  Error response from daemon:
  Conflict.
  The container name &quot;/dstar-gantry-MYCORPUS&quot; is already in use by container &quot;51cea72ba7cf14a5a44ee373b6f81f1b07da5b947e4f852cea8566b11017752d&quot;.
  You have to remove (or rename) that container to be able to reuse that name.
 See &#39;docker run --help&#39;.</code></pre>

<p>This error is emitted by <a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a> if you attempt to invoke a <code>dstar-gantry</code> operation for a <code><a href="#c-CORPUS">CORPUS</a></code> for which there is already a docker container running (or if you attempt to invoke multiple simultaneous <code>dstar-gantry</code> operations without specifying any <code><a href="#c-CORPUS">CORPUS</a></code>). By default, <code>dstar-gantry.sh</code> implicitly prepends the <a href="https://docs.docker.com/engine/reference/run/#name---name"><code>--name=dstar-gantry-MYCORPUS</code></a> option to <a href="#Docker-Options"><code>DOCKER_OPTS</code></a> when invoking the embedded container. Since <a href="https://docs.docker.com/engine/reference/run"><code>docker run</code></a> will refuse to run 2 different containers of the same name (as the error message clearly states), at most one gantry container can be running per corpus and <code>GANTRYHOST</code> by default.</p>

<p>To see which <code>docker</code> containers are currently running, you can use the <a href="https://docs.docker.com/engine/reference/commandline/ps/"><code>docker ps</code></a> command (also check <a href="https://docs.docker.com/engine/reference/commandline/ps/"><code>docker ps -a</code></a> to include stopped or terminated containers).</p>

<p>If you <i>really</i> want to run a second docker container for a given <a href="#c-CORPUS"><code>CORPUS</code></a>, you will need to override the default container name in <a href="#Docker-Options"><code>DOCKER_OPTS</code></a>, e.g.:</p>

<pre><code> $ dstar-gantry.sh -c MYCORPUS -p 8001 run -- -name=MYCORPUS-8001</code></pre>

<p>If you use an alternative container name for a <a href="#MYCORPUS-staging">staging</a> instance with the gantry <a href="#run">&quot;run&quot;</a> action, you will need to adjust the <a href="https://docs.docker.com/engine/reference/commandline/kill/"><code>docker kill</code></a> command accordingly:</p>

<pre><code> $ docker kill MYCORPUS-8001</code></pre>

</dd>
<dt id="E000013-...-Permission-denied">E000013 ... Permission denied</dt>
<dd>

<pre><code> CMD /home/ddc-dstar/dstar/bin/dstar-nice.sh svn co --depth=files svn+ssh://svn.dwds.de/home/svn/dev/ddc-dstar/trunk/corpus MYCORPUS
 svn: E000013: Can&#39;t create directory &#39;/home/ddc-dstar/dstar/corpora/MYCORPUS/.svn&#39;: Permission denied</code></pre>

<p>&quot;Permission denied&quot; errors from SVN during corpus checkout in the embedded <code>dstar-buildhost</code> container can occur whenever you attempt to operate on a <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> working copy for which the gantry build <a href="#u-USER"><code>USER</code></a> and/or <a href="#g-GROUP"><code>GROUP</code></a> does not have sufficient permissions. Typically, this is because the <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> checkout is owned by a different user. If you consistently use the default <code>ddc-admin</code> user for corpus operations as <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Play-nicely">recommended in the dstar-HOWTO</a>, you should never encounter this error.</p>

<p>How you solve this problem is entirely up to you. Some possibilities include:</p>

<ul>

<li><p>Ask the current owner or an administrator (<code>root</code>) to alter the permissions recursively using standard UNIX tools (<code>chown -R</code>, <code>chmod -R</code>), or do so yourself with <code>sudo</code>.</p>

</li>
<li><p>If you have read permission, you can copy the directory to a new location with appropriate permissions and specify the path to your new copy using the <a href="#C-CORPUS_ROOT">&quot;-C CORPUS_ROOT&quot;</a> option. This may use a lot of additional disk space, so it&#39;s best to avoid this if possible.</p>

</li>
<li><p>You can create a new <code>CORPUS_ROOT</code> directory with appropriate permissions and specify its location with the <a href="#C-CORPUS_ROOT">&quot;-C CORPUS_ROOT&quot;</a> option. This is even more wasteful than copying the original directory.</p>

</li>
</ul>

<p>... see also <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Ownership-and-Permissions">&quot;Ownership and Permissions&quot; in the dstar-HOWTO</a>.</p>

</dd>
<dt id="AH00526:-...-Unknown-Authn-provider:-external">AH00526: ... Unknown Authn provider: external</dt>
<dd>

<pre><code> INFO spawned: &#39;apache&#39; with pid 1417
 apache stderr | AH00526: Syntax error on line 32 of /etc/apache2/sites-enabled/020-dstar-MYCORPUS.conf: Unknown Authn provider: external
 INFO exited: apache (exit status 1; not expected)
 apache stdout | Action &#39;-D FOREGROUND -e notice&#39; failed.
 The Apache error log may have more information.
 INFO gave up: apache entered FATAL state, too many start retries too quickly</code></pre>

<p>This error message is emitted by the <a href="https://httpd.apache.org/">apache</a> HTTP server to the <a href="https://docs.docker.com/engine/reference/commandline/logs/"><code>docker logs</code></a> console of a container <a href="#run">&quot;run&quot;</a> action if the <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#Corpus-Configuration">corpus configuration</a> set the <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#WEB_SITE_AUTH_EXTERNAL"><code>WEB_SITE_AUTH_EXTERNAL</code></a> variable to a non-trivial value (e.g. <code>auth_dwdsdb</code>). The <a href="#i-IMAGE"><code>dstar-buildhost</code></a> does not currently support the apache external authorization module, so you should specify an override <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#WEB_SITE_AUTH_EXTERNAL"><code>WEB_SITE_AUTH_EXTERNAL=no</code></a> with the <a href="#e-VAR-VALUE">&quot;-e VAR=VALUE&quot;</a> option. It&#39;s probably a good idea to force <a href="https://kaskade.dwds.de/dstar/doc/README_build.html#WEB_SITE_PUBLIC"><code>WEB_SITE_PUBLIC=yes</code></a> in staging containers too:</p>

<pre><code> $ dstar-gantry.sh -c MYCORPUS -eWEB_SITE_AUTH_EXTERNAL=no -eWEB_SITE_PUBLIC=yes run</code></pre>

<p>Future versions of gantry may implicitly set these values for staging instances.</p>

</dd>
<dt id="connection-reset-by-peer">connection reset by peer</dt>
<dd>

<pre><code> Connection reset by peer.
 The connection was reset.
 The connection to the server was reset while the page was loading.</code></pre>

<p>This message may appear (e.g. in your local browser) when attempting to access a <a href="#MYCORPUS-staging">staging instance</a> from your local workstation, in particular if you are using an <a href="https://www.ssh.com/ssh/tunneling/example">ssh tunnel</a> for port-forwarding. Some success has been reported using the <code>-g</code> option to <code>ssh</code> when setting up the tunnel as suggested <a href="https://serverfault.com/questions/427703/ssh-tunnel-doesnt-work">here</a>, i.e.</p>

<pre><code> WORKSTATION $ ssh -g 8002:GANTRYHOST:8001 -N GANTRYHOST &amp; gantry_tunnel_pid=$!</code></pre>

</dd>
<dt id="bind:-Address-already-in-use">bind: Address already in use</dt>
<dd>

<pre><code> bind: Address already in use
 channel_setup_fwd_listener_tcpip: cannot listen to port: 8000
 Could not request local forwarding.</code></pre>

<p>This error may appear when attempting to set up an an <a href="https://www.ssh.com/ssh/tunneling/example">ssh tunnel</a> for accessing a <a href="#MYCORPUS-staging">staging instance</a> behind a firewall. It indicates that the local port you have chosen for the tunnel is already allocated to another process (which might be a previous invocation of the same ssh-tunnel you have forgotten to kill). Either kill the obstructing process or choose a different local port for your ssh tunnel; see also <a href="https://askubuntu.com/questions/447820/ssh-l-error-bind-address-already-in-use">https://askubuntu.com/questions/447820/ssh-l-error-bind-address-already-in-use</a>.</p>

</dd>
<dt id="No-rule-to-make-target-init-rml.-Stop">No rule to make target &#39;init-rml&#39;. Stop.</dt>
<dd>

<pre><code> make: Entering directory &#39;/home/ddc-dstar/dstar/corpora/MYCORPUS/server&#39;
 make: *** No rule to make target &#39;init-rml&#39;.  Stop.
 make: Leaving directory &#39;/home/ddc-dstar/dstar/corpora/MYCORPUS/server&#39;
 build EVAL: echo &#39;/home/ddc-dstar/dstar/corpora/MYCORPUS/server&#39; &gt;&gt;/etc/default/ddc_servers
 build RUN: dstar-nice.sh make -e -s -C ../corpora/MYCORPUS/web corpus.ttk custom.ttk dstar-rc site-rc
 make: *** No rule to make target &#39;corpus.ttk&#39;.  Stop.
 build ERROR: failed to initialize dstar configuration for web directory &#39;../corpora/MYCORPUS/web&#39;</code></pre>

<p>This error has been observed when attempting to <a href="#run">run</a> a <a href="#MYCORPUS-staging">staging instance</a> for a corpus whose <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT/server</code></a> directory was missing the requisite shared dstar infrastructure code (in this case, <code>CORPUS_ROOT/server/Makefile</code>) after failure of the infrastructure SVN server. To avoid this error, ensure that your <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> directory is a valid SVN working copy, and resolve any <a href="#SVN-conflicts">conflicts</a> reported by <code>svn status -u CORPUS_ROOT</code> before attempting to <a href="#install">install</a> or <a href="#run">run</a> a staging instance for that corpus.</p>

</dd>
<dt id="SVN-conflicts">SVN conflicts</dt>
<dd>

<pre><code> Skipped &#39;corpora/MYCORPUS/...&#39; -- Node remains in conflict
 ...
 Summary of conflicts:
   Skipped paths: N
   Tree conflicts: N</code></pre>

<p>SVN conflicts can arise when attempting to update a <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT</code></a> (sub)directory which contains inconsistent SVN metadata. SVN conflicts must be resolved manually; see <a href="http://svnbook.red-bean.com/">http://svnbook.red-bean.com/</a> for details.</p>

</dd>
<dt id="Warning:-the-RSA-host-key-for-HOST-differs-from-the-key-for-the-IP-address-IPADDR">Warning: the RSA host key for &#39;HOST&#39; differs from the key for the IP address &#39;IPADDR&#39;</dt>
<dd>

<pre><code> Warning: the RSA host key for &#39;HOST&#39; differs from the key for the IP address &#39;IPADDR&#39;
 Offending key for IP in /home/dstar-build/.ssh/known_hosts:10
 Matching host key in /home/dstar-build/.ssh/known_hosts:4</code></pre>

<p>This warning message can arise due to a stale <code>known_hosts</code> file for the ephemeral <code>dstar-build</code> user in the running <a href="#i-IMAGE"><code>dstar-buildhost</code></a> container. It should be non-fatal, but please report it if you encounter it during a <code>dstar-gantry.sh</code> operation.</p>

</dd>
<dt id="dstar.perl:-could-not-connect-to-DDC-server-localhost-port-PORT:-Connection-refused">dstar.perl: could not connect to DDC server localhost port PORT: Connection refused</dt>
<dd>

<p>This error can appear in a browser when attempting to access a <a href="#MYCORPUS-staging">staging instance</a> for which the <code>ddc_daemon</code> process in <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT/server</code></a> has not (yet) successfully started. Check the <a href="https://docs.docker.com/engine/reference/commandline/logs/"><code>docker logs</code></a> for the staging container and/or its <a href="http://supervisord.org/">supervisord</a> GUI at <code>http://CONTAINER:9001</code> for more details.</p>

</dd>
<dt id="Cannot-allocate-memory">Cannot allocate memory</dt>
<dd>

<pre><code> (server-main[pid=3101]) &gt; Error! Cannot load project index/catch22/catch22.con: cannot load index of project index/catch22/catch22.con: ddcMMap::open(): mmap() failed for file &#39;index/catch22/catch22._storage_WordSep&#39;: Cannot allocate memory 
 ddc_daemon[3101]: (server-main[pid=3101]) &gt; Error! Cannot load project index/catch22/catch22.con: cannot load index of project index/catch22/catch22.con: ddcMMap::open(): mmap() failed for file &#39;index/catch22/catch22._storage_WordSep&#39;: Cannot allocate memory 
 terminate called after throwing an instance of &#39;std::runtime_error&#39;</code></pre>

<p>This message indicates can occur if the <code>ddc_daemon</code> process for a <a href="#MYCORPUS-staging">staging instance</a> in <a href="#C-CORPUS_ROOT"><code>CORPUS_ROOT/server</code></a> is unable to allocate sufficient <a href="https://en.wikipedia.org/wiki/Virtual_memory">virtual memory</a> address space to accomodate its index data, possibly due to a misconfiguration of the dstar make variable <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#RUNHOST-memory"><code>SERVER_ULIMIT_MEM</code></a>. Try raising the value of <code>SERVER_ULIMIT_MEM</code> or setting it to the empty string: if the error message is no longer raised, report the adjustment and/or modify the appropriate configuration file(s) (e.g. <code>CORPUS.mak</code>).</p>

<p>Contemporary 64-bit linux architectures can handle up to 2^48 bytes (= 256 TB) of virtual memory address space on a single machine, regardless of the amount of physical RAM installed, so this error is unlikely to be caused by machine limitations on the gantry host itself.</p>

</dd>
<dt id="other-errors">other errors</dt>
<dd>

<p>See <a href="https://kaskade.dwds.de/dstar/doc/HOWTO.html#COMMON-ERRORS">&quot;COMMON ERRORS&quot; in the dstar-HOWTO</a>.</p>

</dd>
</dl>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<ul>

<li><p>The <a href="https://kaskade.dwds.de/dstar/doc/README.html">dstar README</a> and the references mentioned therein describe the D* framework in more detail. Most of the D* documentation available under <a href="https://kaskade.dwds.de/dstar/doc/"><code>https://kaskade.dwds.de/dstar/doc</code></a> predates the existence of <code>dstar-gantry</code> and of the <code>dstar-buildhost</code> image itself, and in the context of <code>dstar-gantry</code> should be interpreted relative to the running <code>dstar-buildhost</code> container.</p>

</li>
<li><p><a href="https://kaskade.dwds.de/dstar/doc/README_sources.html"><code>dstar/doc/README_sources.txt</code></a> contains details on corpus source TEI-XML conventions.</p>

</li>
<li><p><a href="https://kaskade.dwds.de/dstar/doc/README_ssh.html"><code>dstar/doc/README_ssh.txt</code></a> may provide some help setting up a new ssh identity. Note that <code>dstar-gantry</code> requires an accessible <code>ssh-agent</code>, so if you want to run <code>dstar-gantry</code> on your local workstation or some other non-production host, you may need to <a href="https://kaskade.dwds.de/dstar/doc/README_ssh.html#Manual-ssh-agent-daemon">run ssh-agent manually</a>.</p>

</li>
<li><p><a href="https://kaskade.dwds.de/dstar/doc/Changes.html"><code>dstar/doc/Changes.txt</code></a> contains a manual log of D*-related changes.</p>

</li>
<li><p>See the <a href="https://docs.docker.com/engine/reference/run/"><code>docker-run</code></a> manpage for details on docker options.</p>

</li>
</ul>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Bryan Jurish &lt;jurish@bbaw.de&gt; created the ddc-dstar corpus administration system and the <code>dstar-gantry</code> wrappers.</p>


</body>

</html>


